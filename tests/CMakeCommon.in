set(TEST_LIBRARIES)

if (GTEST_FOUND)
    include_directories(${GTEST_INCLUDE_DIRS})
    set(TEST_LIBRARIES ${GTEST_BOTH_LIBRARIES})
else()
    set(TEST_LIBRARIES gtest;gtest_main)
endif()

file(GLOB TESTS_SOURCES ${TESTS_SOURCES}
        ./*.cpp
        )

add_executable(${TEST} ${TESTS_SOURCES})

target_link_libraries(
        ${TEST}
        ${PROJECT_LIB}
        ${TEST_LIBRARIES}
)

add_dependencies(
        ${TEST}

        ${PROJECT_LIB}
        ${COMMON_DEPENDENCIES}
)

#SET(CMAKE_EXE_LINKER_FLAGS
#        "${CMAKE_EXE_LINKER_FLAGS}  /ENTRY:mainCRTStartup")

#if(MSVC)
#    add_compile_options(
#            $<$<CONFIG:>:/MT> #---------|
#            $<$<CONFIG:Debug>:/MTd> #---|-- Statically link the runtime libraries
#            $<$<CONFIG:Release>:/MT> #--|
#    )
#endif()

#set_property(TARGET ${TEST} PROPERTY
#        MSVC_RUNTIME_LIBRARY "MultiThreaded$<$<CONFIG:Debug>:Debug>")

#target_link_options(${TEST} PRIVATE "/SUBSYSTEM:WINDOWS")

add_test(test ${TEST})
enable_testing()

